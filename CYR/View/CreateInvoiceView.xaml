<UserControl
  x:Class="CYR.View.CreateInvoiceView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:CYR.View"
  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:CYR.ViewModel"
  d:DataContext="{d:DesignInstance Type=vm:CreateInvoiceViewModel,
                                   IsDesignTimeCreatable=False}"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d">
  <Grid Background="White">
    <Grid.RowDefinitions>
      <RowDefinition Height="auto" />
      <RowDefinition Height="auto" />
      <RowDefinition Height="3*" />
    </Grid.RowDefinitions>
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="40" />
      </Grid.RowDefinitions>
      <Grid
        Grid.Row="0"
        Grid.Column="0"
        Margin="10">
        <Grid.RowDefinitions>
          <RowDefinition Height="*" />
          <RowDefinition Height="*" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TextBox
          Grid.Row="0"
          Margin="0,0,0,4"
          materialDesign:HintAssist.Hint="Kunde (Name)"
          FontSize="18"
          Style="{StaticResource MaterialDesignOutlinedTextBox}"
          Text="{Binding ClientName}" />
        <TextBox
          Grid.Row="1"
          Margin="0,0,0,4"
          materialDesign:HintAssist.Hint="Straße (Beispielstraße 21a)"
          FontSize="18"
          Style="{StaticResource MaterialDesignOutlinedTextBox}"
          Text="{Binding ClientStreet}" />
        <TextBox
          Grid.Row="2"
          Margin="0,0,0,4"
          materialDesign:HintAssist.Hint="Ort (30151 Hannover)"
          FontSize="18"
          Style="{StaticResource MaterialDesignOutlinedTextBox}"
          Text="{Binding ClientCityPlz}" />
      </Grid>
      <Grid
        Grid.Row="0"
        Grid.Column="1"
        Margin="10">
        <Grid.RowDefinitions>
          <RowDefinition Height="*" />
          <RowDefinition Height="*" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBox
          Grid.Row="0"
          Margin="0,0,0,4"
          materialDesign:HintAssist.Hint="Betreff"
          FontSize="18"
          Style="{StaticResource MaterialDesignOutlinedTextBox}"
          Text="{Binding Subject}" />
        <Border
          Grid.Row="1"
          BorderBrush="Black"
          BorderThickness="1"
          CornerRadius="5">
          <StackPanel Orientation="Horizontal">
            <TextBlock
              Margin="10,0,0,0"
              VerticalAlignment="Center"
              FontSize="18"
              Text="Zeitraum:" />
            <DatePicker
              Margin="10,0,0,0"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              VerticalContentAlignment="Center"
              FontSize="18"
              SelectedDate="{Binding StartDate, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock
              Margin="10,0,0,0"
              VerticalAlignment="Center"
              FontSize="18"
              Text="Bis" />
            <DatePicker
              Margin="10,0,0,0"
              HorizontalAlignment="Right"
              VerticalAlignment="Center"
              VerticalContentAlignment="Center"
              FontSize="18"
              SelectedDate="{Binding EndDate, UpdateSourceTrigger=PropertyChanged}" />
          </StackPanel>
        </Border>
        <Grid Grid.Row="2">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="auto" />
          </Grid.ColumnDefinitions>
          <TextBox
            Grid.Column="0"
            HorizontalAlignment="Left"
            materialDesign:HintAssist.Hint="Rechnungsnummer"
            FontSize="18"
            Style="{StaticResource MaterialDesignOutlinedTextBox}"
            Text="{Binding InvoiceNumber}" />
          <CheckBox
            Grid.Column="1"
            Margin="10,0,0,0"
            Content="MwSt."
            FontSize="18"
            IsChecked="{Binding IsMwstApplicable}" />
          <DatePicker
            Grid.Column="2"
            Margin="10,0,0,0"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            VerticalContentAlignment="Center"
            SelectedDate="{Binding InvoiceDate, UpdateSourceTrigger=PropertyChanged}" />
        </Grid>

      </Grid>
      <StackPanel
        Grid.Row="1"
        Grid.Column="0"
        Grid.ColumnSpan="2"
        HorizontalAlignment="Right"
        Orientation="Horizontal">
        <materialDesign:PopupBox
          FontSize="18"
          PlacementMode="BottomAndAlignCentres"
          PopupUniformCornerRadius="10"
          StaysOpen="True">
          <Grid MinWidth="250">
            <Grid.RowDefinitions>
              <RowDefinition Height="*" />
              <RowDefinition Height="*" />
              <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <TextBox Grid.Row="0" Text="{Binding ObjectNumber}" />
          </Grid>
        </materialDesign:PopupBox>
        <Button
          Margin="0,0,10,0"
          HorizontalAlignment="Right"
          VerticalAlignment="Center"
          Command="{Binding CreateInvoiceCommand}"
          Content="Preview"
          Cursor="Hand" />
        <Button
          Margin="0,0,10,0"
          HorizontalAlignment="Right"
          VerticalAlignment="Center"
          Command="{Binding SaveInvoiceCommand}"
          CommandParameter="{Binding}"
          Content="Save"
          Cursor="Hand" />
      </StackPanel>
    </Grid>
    <Grid Grid.Row="2">
      <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="50" />
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <ListView
        Grid.Row="0"
        Grid.Column="0"
        ItemsSource="{Binding Positions, UpdateSourceTrigger=PropertyChanged}">
        <ListView.View>
          <GridView>
            <GridViewColumn Width="100" Header="Menge">
              <GridViewColumn.HeaderContainerStyle>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="GridViewColumnHeader">
                  <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
              </GridViewColumn.HeaderContainerStyle>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <TextBox
                    Width="70"
                    FontSize="15"
                    Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F2}}" />
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn Width="100" Header="Einheit">
              <GridViewColumn.HeaderContainerStyle>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="GridViewColumnHeader">
                  <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
              </GridViewColumn.HeaderContainerStyle>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <ComboBox
                    Width="70"
                    DisplayMemberPath="Name"
                    FontSize="15"
                    ItemsSource="{Binding UnitsOfMeasure, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding UnitOfMeasure, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn Width="auto" Header="Bezeichnung">
              <GridViewColumn.HeaderContainerStyle>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="GridViewColumnHeader">
                  <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
              </GridViewColumn.HeaderContainerStyle>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <ComboBox
                    DisplayMemberPath="Name"
                    MaxDropDownHeight="150"
                    FontSize="15"
                    IsEditable="True"
                    Text="{Binding ManuallyInsertedArticle,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                    ItemsSource="{Binding Items, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding OrderItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn Width="100" Header="E-Preis">
              <GridViewColumn.HeaderContainerStyle>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="GridViewColumnHeader">
                  <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
              </GridViewColumn.HeaderContainerStyle>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <TextBox
                    Width="70"
                    FontSize="15"
                    Text="{Binding Price, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F2}}" />
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn Width="100" Header="G-Preis">
              <GridViewColumn.HeaderContainerStyle>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="GridViewColumnHeader">
                  <Setter Property="HorizontalAlignment" Value="Left" />
                </Style>
              </GridViewColumn.HeaderContainerStyle>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock FontSize="15" Text="{Binding TotalPrice, UpdateSourceTrigger=PropertyChanged, Delay=500, StringFormat=N2}" />
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <Button Command="{Binding DataContext.SaveArticleCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding}">
                    <Button.Content>
                      <materialDesign:PackIcon Kind="Add" />
                    </Button.Content>
                  </Button>
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn>
              <GridViewColumn.CellTemplate>
                <DataTemplate>
                  <Button Command="{Binding DataContext.DeleteRowCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding}">
                    <Button.Content>
                      <materialDesign:PackIcon Kind="Delete" />
                    </Button.Content>
                  </Button>
                </DataTemplate>
              </GridViewColumn.CellTemplate>
            </GridViewColumn>
          </GridView>
        </ListView.View>
      </ListView>
      <Button
        Grid.Row="2"
        Margin="0,0,10,0"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        Command="{Binding AddNewRowCommand}">
        <Button.Content>
          <materialDesign:PackIcon
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            VerticalContentAlignment="Center"
            Kind="Add" />
        </Button.Content>
      </Button>
    </Grid>
  </Grid>
</UserControl>
